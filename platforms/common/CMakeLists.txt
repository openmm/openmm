#
# Include compute related files.
#

SET(CC_SOURCE_DIR "${CMAKE_CURRENT_SOURCE_DIR}/src")
SET(CC_SOURCE_CLASS CommonKernelSources)
SET(CC_KERNELS_CPP ${CMAKE_CURRENT_BINARY_DIR}/src/${CC_SOURCE_CLASS}.cpp)
SET(CC_KERNELS_H ${CMAKE_CURRENT_BINARY_DIR}/src/${CC_SOURCE_CLASS}.h)
INCLUDE_DIRECTORIES(BEFORE ${CMAKE_CURRENT_BINARY_DIR}/src)
FILE(GLOB COMMON_KERNELS ${CC_SOURCE_DIR}/kernels/*.cc)
ADD_CUSTOM_COMMAND(OUTPUT ${CC_KERNELS_CPP} ${CC_KERNELS_H}
    COMMAND ${CMAKE_COMMAND}
    ARGS -D CC_SOURCE_DIR=${CC_SOURCE_DIR} -D CC_KERNELS_CPP=${CC_KERNELS_CPP} -D CC_KERNELS_H=${CC_KERNELS_H} -D CC_SOURCE_CLASS=${CC_SOURCE_CLASS} -P ${CMAKE_CURRENT_SOURCE_DIR}/EncodeCCFiles.cmake
    DEPENDS ${COMMON_KERNELS}
)
SET_SOURCE_FILES_PROPERTIES(${CC_KERNELS_CPP} ${CC_KERNELS_H} PROPERTIES GENERATED TRUE)
ADD_CUSTOM_TARGET(CommonKernels DEPENDS ${CC_KERNELS_CPP} ${CC_KERNELS_H})

# Install headers

FILE(GLOB CORE_HEADERS include/*.h)
INSTALL_FILES(/include/openmm/common FILES ${CORE_HEADERS})
